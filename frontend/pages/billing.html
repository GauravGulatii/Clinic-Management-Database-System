<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing - Clinic Management System</title>
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        .dashboard-container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }
        
        .main-content {
            padding: 15px;
            overflow-y: auto;
            flex: 1;
        }
        
        .billing-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .billing-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            color: #666;
            font-size: 14px;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-control label {
            font-weight: bold;
            color: #555;
        }
        
        .filter-control select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .billing-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .billing-table th {
            background-color: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #ddd;
        }
        
        .billing-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .billing-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-paid {
            display: inline-block;
            padding: 3px 8px;
            background-color: #e8f5e9;
            color: #4CAF50;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            display: inline-block;
            padding: 3px 8px;
            background-color: #fff8e1;
            color: #FFC107;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-overdue {
            display: inline-block;
            padding: 3px 8px;
            background-color: #ffebee;
            color: #F44336;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .payment-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .payment-btn:hover {
            background-color: #45a049;
        }
        
        .payment-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .invoice-btn {
            background-color: transparent;
            color: #2196F3;
            border: 1px solid #2196F3;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .invoice-btn:hover {
            background-color: #e3f2fd;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-hospital-symbol"></i>
                <h2>Patient Portal</h2>
            </div>
            <ul class="nav-links">
                <li>
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </li>
                <li>
                    <i class="fas fa-calendar-alt"></i>
                    <span>Book Appointment</span>
                </li>
                <li>
                    <i class="fas fa-history"></i>
                    <span>Appointment History</span>
                </li>
                <li>
                    <i class="fas fa-file-medical"></i>
                    <span>Medical Records</span>
                </li>
                <li>
                    <i class="fas fa-prescription"></i>
                    <span>Prescriptions</span>
                </li>
                <li class="active">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Billing</span>
                </li>
                <li class="logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <header>
                <h1>Billing & Payments</h1>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="profile-name">My Profile</span>
                </div>
            </header>

            <div class="billing-container">
                <div class="billing-summary">
                    <div class="summary-item">
                        <div class="summary-value" id="total-due">$0.00</div>
                        <div class="summary-label">Total Due</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="pending-bills">0</div>
                        <div class="summary-label">Pending Bills</div>
                    </div>
                </div>

                <div class="filter-controls">
                    <div class="filter-control">
                        <label for="status-filter">Status:</label>
                        <select id="status-filter">
                            <option value="all">All</option>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="filter-control">
                        <label for="date-filter">Date Range:</label>
                        <select id="date-filter">
                            <option value="all">All Time</option>
                            <option value="current-year">Current Year</option>
                            <option value="last-6-months">Last 6 Months</option>
                            <option value="last-3-months">Last 3 Months</option>
                        </select>
                    </div>
                </div>

                <table class="billing-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="billing-list">
                        <!-- Billing data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        // Get username from sessionStorage
        let username = sessionStorage.getItem('username') || "Guest";
        document.getElementById("profile-name").textContent = username;
        
        // Add event listeners for navigation
        document.querySelector('.nav-links li:first-child').addEventListener('click', function() {
            window.location.href = 'patient-dashboard.html';
        });
        
        document.querySelector('.nav-links li:nth-child(2)').addEventListener('click', function() {
            window.location.href = 'book-appointment.html';
        });
        
        document.querySelector('.nav-links li:nth-child(3)').addEventListener('click', function() {
            window.location.href = 'appointment-history.html';
        });
        
        document.querySelector('.nav-links li:nth-child(4)').addEventListener('click', function() {
            window.location.href = 'medical-records.html';
        });
        
        document.querySelector('.nav-links li:nth-child(5)').addEventListener('click', function() {
            window.location.href = 'prescriptions.html';
        });
        
        // Mock billing data
        const mockBillingData = [
            {
                id: 'bill-001',
                date: '2023-05-15',
                description: 'General Checkup',
                amount: 150.00,
                status: 'Paid',
                paymentDate: '2023-05-20'
            },
            {
                id: 'bill-002',
                date: '2023-04-10',
                description: 'Blood Test',
                amount: 200.00,
                status: 'Pending',
                dueDate: '2023-06-10'
            },
            {
                id: 'bill-003',
                date: '2023-03-05',
                description: 'X-Ray',
                amount: 300.00,
                status: 'Paid',
                paymentDate: '2023-03-15'
            },
            {
                id: 'bill-004',
                date: '2023-02-20',
                description: 'Specialist Consultation',
                amount: 250.00,
                status: 'Paid',
                paymentDate: '2023-02-25'
            },
            {
                id: 'bill-005',
                date: '2023-01-15',
                description: 'Physical Therapy',
                amount: 180.00,
                status: 'Overdue',
                dueDate: '2023-05-05'
            }
        ];
        
        // Store mock billing data in localStorage if not already present
        if (!localStorage.getItem('billingData')) {
            localStorage.setItem('billingData', JSON.stringify(mockBillingData));
        }
        
        // Update billing summary
        function updateBillingSummary() {
            const billingData = JSON.parse(localStorage.getItem('billingData')) || [];
            
            // Calculate total due
            const pendingBills = billingData.filter(bill => bill.status === 'Pending' || bill.status === 'Overdue');
            const totalDue = pendingBills.reduce((total, bill) => total + bill.amount, 0);
            document.getElementById('total-due').textContent = `$${totalDue.toFixed(2)}`;
            
            // Count pending bills
            document.getElementById('pending-bills').textContent = pendingBills.length;
        }
        
        // Display billing data
        function displayBillingData() {
            const billingData = JSON.parse(localStorage.getItem('billingData')) || [];
            const billingList = document.getElementById('billing-list');
            
            // Get filter values
            const statusFilter = document.getElementById('status-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            
            // Apply filters
            let filteredBills = billingData;
            
            if (statusFilter !== 'all') {
                filteredBills = filteredBills.filter(bill => bill.status === statusFilter);
            }
            
            // Apply date filter
            const today = new Date();
            const currentYear = today.getFullYear();
            
            if (dateFilter === 'current-year') {
                filteredBills = filteredBills.filter(bill => new Date(bill.date).getFullYear() === currentYear);
            } else if (dateFilter === 'last-6-months') {
                const sixMonthsAgo = new Date();
                sixMonthsAgo.setMonth(today.getMonth() - 6);
                
                filteredBills = filteredBills.filter(bill => new Date(bill.date) >= sixMonthsAgo);
            } else if (dateFilter === 'last-3-months') {
                const threeMonthsAgo = new Date();
                threeMonthsAgo.setMonth(today.getMonth() - 3);
                
                filteredBills = filteredBills.filter(bill => new Date(bill.date) >= threeMonthsAgo);
            }
            
            // Sort bills by date (newest first)
            filteredBills.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Check if any bills match the filters
            if (filteredBills.length === 0) {
                billingList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No billing records found matching the selected filters</td></tr>';
                return;
            }
            
            // Display filtered bills
            billingList.innerHTML = '';
            filteredBills.forEach(bill => {
                const row = document.createElement('tr');
                
                // Format date
                const formattedDate = new Date(bill.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${bill.description}</td>
                    <td>$${bill.amount.toFixed(2)}</td>
                    <td><span class="status-${bill.status.toLowerCase()}">${bill.status}</span></td>
                    <td>
                        <button class="invoice-btn" data-id="${bill.id}">View Invoice</button>
                        ${bill.status === 'Pending' || bill.status === 'Overdue' ? 
                            `<button class="payment-btn" data-id="${bill.id}">Pay Now</button>` : 
                            `<button class="payment-btn" disabled>Paid</button>`
                        }
                    </td>
                `;
                
                billingList.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.invoice-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const billId = this.getAttribute('data-id');
                    alert(`Invoice for bill ${billId} will be downloaded soon.`);
                });
            });
            
            document.querySelectorAll('.payment-btn:not([disabled])').forEach(button => {
                button.addEventListener('click', function() {
                    const billId = this.getAttribute('data-id');
                    
                    // Find the bill in the data
                    const billingData = JSON.parse(localStorage.getItem('billingData'));
                    const billIndex = billingData.findIndex(bill => bill.id === billId);
                    
                    if (billIndex !== -1) {
                        if (confirm(`Proceed to payment for $${billingData[billIndex].amount.toFixed(2)}?`)) {
                            // Update bill status to paid
                            billingData[billIndex].status = 'Paid';
                            billingData[billIndex].paymentDate = new Date().toISOString().split('T')[0];
                            
                            // Save updated data
                            localStorage.setItem('billingData', JSON.stringify(billingData));
                            
                            alert('Payment successful! Thank you.');
                            
                            // Refresh display
                            updateBillingSummary();
                            displayBillingData();
                        }
                    }
                });
            });
        }
        
        // Add event listeners to filter controls
        document.getElementById('status-filter').addEventListener('change', displayBillingData);
        document.getElementById('date-filter').addEventListener('change', displayBillingData);
        
        // Initialize the page
        updateBillingSummary();
        displayBillingData();
    </script>
</body>
</html> 