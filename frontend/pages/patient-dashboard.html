<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard – Clinic Management System</title>

    <!-- styles -->
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* page‑specific tweaks */
        body,html{margin:0;padding:0;overflow:hidden;width:100vw;height:100vh;}
        .dashboard-container{display:flex;width:100vw;height:100vh;}
        .main-content{padding:15px;overflow-y:auto;flex:1;}
        .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(calc(33.333% - 20px),1fr));gap:20px;width:100%;}
        .card{padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1);min-height:200px;overflow-y:auto;}
        .appointment-item{border-left:4px solid #4CAF50;padding:10px;margin-bottom:15px;background:#f9f9f9;border-radius:0 5px 5px 0;}
        .appointment-item p{margin:5px 0;}
    </style>
</head>
<body>

<div class="dashboard-container">
    <!-- ─────────── Sidebar ─────────── -->
    <nav class="sidebar">
        <div class="logo">
            <i class="fas fa-hospital-symbol"></i>
            <h2>Patient Portal</h2>
        </div>
        <ul class="nav-links">
            <li class="active">
                <i class="fas fa-home"></i><span>Dashboard</span>
            </li>
            <li>
                <i class="fas fa-calendar-alt"></i><span>Book Appointment</span>
            </li>
            <li class="logout">
                <i class="fas fa-sign-out-alt"></i><span>Logout</span>
            </li>
        </ul>
    </nav>

    <!-- ─────────── Main content ─────────── -->
    <main class="main-content">
        <header><h1>Dashboard</h1></header>

        <div class="dashboard-grid">
            <div class="card">
                <h3>Upcoming Appointments</h3>
                <div id="appointment-list"><p>No upcoming appointments</p></div>
                <button class="action-btn" id="book-btn">Book New Appointment</button>
            </div>
        </div>
    </main>
</div>

<!-- ─────────── Script ─────────── -->
<script>
/* ---------- constants ---------- */
const API        = 'http://localhost:3000/api';
const patientID  = 1;   // later replace with sessionStorage value

/* ---------- sidebar navigation ---------- */
document.querySelector('.nav-links li:nth-child(2)')
        .onclick = () => location.href = 'book-appointment.html';

document.querySelector('#book-btn')
        .onclick = () => location.href = 'book-appointment.html';

document.querySelector('.logout').onclick = () => {
  if (confirm('Log out?')) {
    sessionStorage.clear();
    location.href = '../index.html';
  }
};

/* ---------- fetch and render upcoming appointments ---------- */
async function displayUpcomingAppointments() {
  try {
    const res  = await fetch(`${API}/appointments/patient/${patientID}`);
    const rows = await res.json();
    const list = document.getElementById('appointment-list');

    if (!rows.length) { list.innerHTML = '<p>No upcoming appointments</p>'; return; }

    list.innerHTML = '';
    rows.forEach(a => {
      const div  = document.createElement('div');
      div.className = 'appointment-item';

      const dateText = new Date(a.appointmentdate).toLocaleDateString();
      const timeText = a.appointmenttime.substring(0,5);

      div.innerHTML = `
        <p><strong>${dateText}</strong></p>
        <p>${timeText}</p>
        <p>${a.doctorname}</p>
      `;
      list.appendChild(div);
    });

  } catch (err) {
    console.error(err);
    alert('Cannot load appointments – check API');
  }
}
displayUpcomingAppointments();
</script>

</body>
</html>
